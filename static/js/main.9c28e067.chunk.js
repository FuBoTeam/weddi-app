(this["webpackJsonpweddi-app"]=this["webpackJsonpweddi-app"]||[]).push([[0],{38:function(e,t,a){},46:function(e,t,a){e.exports=a.p+"static/media/uploadLoading.a33612b2.svg"},48:function(e,t,a){e.exports=a.p+"static/media/loading.822699a4.gif"},51:function(e,t,a){e.exports=a(87)},56:function(e,t,a){},78:function(e,t,a){},87:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(42),o=a.n(r),s=a(23),c=a(10),l=(a(56),a(24)),m=a.n(l),u=a(43),d=a(16),g=a(3),p=a(4),h=a(15),f=a(12),b=a(6),v=a(14),y=a(17),w=a.n(y),k=a(44),I=a.n(k),E=a(45),O=a.n(E),j=(a(78),{doc:{title:"<3 YaYun & ChinHui <3"},firebase:{apiKey:"AIzaSyD_1irJWOgT9x5fvmbXJm0fRRRZ8DNUfpU",authDomain:"weddi-app.firebaseapp.com",databaseURL:"https://weddi-app.firebaseio.com/",projectId:"weddi-app",storageBucket:"image.weddi.app",messagingSenderId:"324415165027",appId:"1:324415165027:web:76b8291835ef32c5c75e56"},img:{namespace:"chyy",endpoint:"https://storage.googleapis.com/image.weddi.app/",totalImgs:114,bgImgsShouldBePicked:40,fmImgsShouldBePicked:5}}),S={doc:{title:"<3 Tony & Claire <3"},firebase:{apiKey:"AIzaSyD_1irJWOgT9x5fvmbXJm0fRRRZ8DNUfpU",authDomain:"weddi-app.firebaseapp.com",databaseURL:"https://weddi-app-tlty.firebaseio.com/",projectId:"weddi-app",storageBucket:"image.weddi.app",messagingSenderId:"324415165027",appId:"1:324415165027:web:76b8291835ef32c5c75e56"},img:{namespace:"tlty",endpoint:"https://storage.googleapis.com/image.weddi.app/",totalImgs:30,bgImgsShouldBePicked:30,fmImgsShouldBePicked:5}},U={doc:{title:"<3 Groom & Bride <3"},firebase:{apiKey:"AIzaSyD_1irJWOgT9x5fvmbXJm0fRRRZ8DNUfpU",authDomain:"weddi-app.firebaseapp.com",databaseURL:"https://weddi-app-test.firebaseio.com/",projectId:"weddi-app",storageBucket:"image.weddi.app",messagingSenderId:"324415165027",appId:"1:324415165027:web:76b8291835ef32c5c75e56"},img:{namespace:"chyy",endpoint:"https://storage.googleapis.com/image.weddi.app/",totalImgs:114,bgImgsShouldBePicked:40,fmImgsShouldBePicked:5}},P=new(function(){function e(){Object(g.a)(this,e),this.config=void 0}return Object(p.a)(e,[{key:"init",value:function(e){this.config||(this.config=function(e){switch(e){case"chyy":return j;case"tlty":return S;default:return U}}(e))}},{key:"doc",get:function(){if(this.config)return this.config.doc;throw Error("config is not set yet")}},{key:"firebase",get:function(){if(this.config)return this.config.firebase;throw Error("config is not set yet")}},{key:"img",get:function(){if(this.config)return this.config.img;throw Error("config is not set yet")}}]),e}()),D=a(25),N=a.n(D),x=function(e,t){for(var a=[],n=e.length-t;n<e.length;n++){var i=N()(n);a.includes(e[i])?a.push(e[n]):a.push(e[i])}return a},L=function(e){for(var t=0;t<=e.length-2;t++){var a=N()(t,e.length-1),n=[e[a],e[t]];e[t]=n[0],e[a]=n[1]}return e},B=function(e,t){var a=new Image;a.src=e,a.onload=t},C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_small";return"".concat(P.img.endpoint).concat(P.img.namespace,"/").concat(e).concat(t,".jpg")},R=(a(38),function(e){function t(){var e;Object(g.a)(this,t),(e=Object(h.a)(this,Object(f.a)(t).call(this))).img=new Image;var a=Object(b.a)(e);return e.img.onload=function(){var e=this;a.setState((function(){return{imgWidth:e.width||0,imgHeight:e.height||0}}))},e.state={imgWidth:0,imgHeight:0},e}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.img.src=this.props.show?this.props.user.imgUrl:""}},{key:"componentDidUpdate",value:function(){this.img.src=this.props.show?this.props.user.imgUrl:""}},{key:"render",value:function(){var e=this.props,t=e.user,a=e.show,n=window.innerWidth<1e3,r=this.state.imgWidth<this.state.imgHeight,o=a&&n&&r?{margin:"10% 20% 50px"}:{};return i.a.createElement("div",{className:a?"dialog show-dialog":"dialog"},i.a.createElement("div",{className:"modal-sm",style:o},i.a.createElement("div",{className:"image-container"},i.a.createElement("img",{className:"user-image",src:t.imgUrl,alt:"images"})),i.a.createElement("div",{className:"message"},i.a.createElement("h2",null,"@ ",t.name),i.a.createElement("p",null,t.greetings))))}}]),t}(n.Component)),H=a(46),F=a.n(H),T=a(47);a(80),a(88);function W(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var A=new(function(){function e(){Object(g.a)(this,e),this.config=void 0,this.app=void 0}return Object(p.a)(e,[{key:"init",value:function(e){this.app||(this.config=e,this.app=T.initializeApp(this.config.firebase))}},{key:"database",get:function(){if(!this.app)throw new Error("app is not initial yet");return this.app.database()}},{key:"storage",get:function(){if(!this.app)throw new Error("app is not initial yet");return this.app.storage()}}]),e}()),J=A,_=function(e){var t=A.database.ref("posts").push().key;if(!t)throw new Error("post id is empty");var a=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?W(a,!0).forEach((function(t){Object(d.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):W(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e,{modifiedTime:(new Date).toISOString(),userAgent:navigator.userAgent,id:t});return A.database.ref("posts").child(t).set(a)},q=function(e,t){if(!A.config)throw new Error("app is not initial yet");return A.storage.ref(A.config.img.namespace).child("public_upload").child(e).put(t)};function z(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function V(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?z(a,!0).forEach((function(t){Object(d.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):z(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var G=function(e){function t(){var e,a;Object(g.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(h.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(r)))).allImgUrls=w()(P.img.totalImgs).map((function(e){return C(e)})),a.fmImgsShouldBePicked=P.img.fmImgsShouldBePicked,a.imgUrls=x(a.allImgUrls,a.fmImgsShouldBePicked),a.state={form:{name:"",greetings:"",pickedImg:{idx:0,url:a.imgUrls[0]},upload:null},isUploadPage:!1,modalDisplay:!1,isLoading:!1},a.onFileChangeHandler=a.onFileChangeHandler.bind(Object(b.a)(a)),a.onTextChangeHandler=a.onTextChangeHandler.bind(Object(b.a)(a)),a.onSubmitHandler=a.onSubmitHandler.bind(Object(b.a)(a)),a.isValid=a.isValid.bind(Object(b.a)(a)),a.getImg=a.getImg.bind(Object(b.a)(a)),a.plusImgIdx=a.plusImgIdx.bind(Object(b.a)(a)),a.renderPhotoRadios=function(){return a.imgUrls.map((function(e,t){var n=a.state.form.pickedImg.idx===t&&a.state.form.pickedImg.url===e;return i.a.createElement(i.a.Fragment,{key:"image_".concat(t)},i.a.createElement("input",{hidden:!0,type:"radio",name:"imgUrl",value:e,checked:n,readOnly:!0}),i.a.createElement("div",{className:"layer"+(n?"":" hidden"),style:{backgroundImage:"url(".concat(e,")")}}),i.a.createElement("img",{className:"fade"+(n?"":" hidden"),src:e,alt:e}))}))},a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"getUpperUrl",value:function(){var e=this.props.match.url.split("/");return e.pop(),e.join("/")}},{key:"getFormData",value:function(){return V({},this.state.form,{imgUrl:this.state.form.pickedImg.url})}},{key:"onFileChangeHandler",value:function(e){var t=this,a=e.target.name,n=e.target.files[0];a&&n&&n.type.startsWith("image/")&&O()(n,(function(e){return e.toBlob((function(e){t.setState((function(t){return{form:V({},t.form,Object(d.a)({},a,e))}}))}),"image/jpeg",.75)}),{maxWidth:2048,maxHeight:2048,orientation:!0,canvas:!0,noRevoke:!0})}},{key:"onTextChangeHandler",value:function(e){var t=e.target.name,a=e.target.value.trim();this.setState((function(e){return{form:V({},e.form,Object(d.a)({},t,a))}}))}},{key:"onSubmitHandler",value:function(e){if(e.preventDefault(),this.isValid())return this.uploadFlow()}},{key:"uploadFlow",value:function(){var e=Object(u.a)(m.a.mark((function e(){var t,a,n,i=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({isLoading:!0}),t=this.state.form.pickedImg.url,!this.state.isUploadPage||!this.state.form.upload){e.next=11;break}return a=I.a.v4(),e.next=6,q(a,this.state.form.upload);case 6:return n=e.sent,e.next=9,n.ref.getDownloadURL();case 9:t=e.sent,this.setState({form:V({},this.state.form,{pickedImg:{idx:-1,url:t}})});case 11:return e.next=13,_(this.getFormData());case 13:B(t,(function(){i.setState({modalDisplay:!0,isLoading:!1}),setTimeout((function(){i.props.history.push(i.getUpperUrl())}),5e3)}));case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getImg",value:function(e){return{idx:e,url:this.imgUrls[e]}}},{key:"plusImgIdx",value:function(e){var t=this,a=(this.state.form.pickedImg.idx+e+this.fmImgsShouldBePicked)%this.fmImgsShouldBePicked;this.setState((function(e){return{form:V({},e.form,{pickedImg:t.getImg(a)})}}))}},{key:"isValid",value:function(){var e=this.state.form,t=e.name,a=e.greetings,n=e.pickedImg;return""!==t.trim()&&""!==a.trim()&&void 0!==n.url}},{key:"renderUploadImageSection",value:function(){return i.a.createElement("label",{className:"img-window upload"},i.a.createElement("input",{hidden:!0,type:"file",name:"upload",placeholder:"\u4e0a\u50b3\u7167\u7247",accept:"image/*",onChange:this.onFileChangeHandler,disabled:this.state.isLoading}),this.state.form.upload&&i.a.createElement("img",{src:URL.createObjectURL(this.state.form.upload),alt:"upload preview"}),!this.state.form.upload&&i.a.createElement("span",{className:"upload-field"},"\u8acb\u4e0a\u50b3\u5716\u7247"))}},{key:"renderPickImageSection",value:function(){var e=this;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"img-window"},i.a.createElement("div",{className:"numbertext"},this.state.form.pickedImg.idx+1," / ",this.fmImgsShouldBePicked),this.renderPhotoRadios()),i.a.createElement("span",{className:"prev",onClick:function(){return!e.state.isLoading&&e.plusImgIdx(-1)}},"\u276e"),i.a.createElement("span",{className:"next",onClick:function(){return!e.state.isLoading&&e.plusImgIdx(1)}},"\u276f"))}},{key:"renderGreetingForm",value:function(){var e=this;return i.a.createElement("form",{className:"greeting-form",onSubmit:this.onSubmitHandler},i.a.createElement("ul",{className:"tabs-view"},i.a.createElement("li",{className:this.state.isUploadPage?"pick":"pick active",onClick:function(){return!e.state.isLoading&&e.setState({isUploadPage:!1})}},"\u6311\u4e00\u5f35\u7167\u7247"),i.a.createElement("li",{className:this.state.isUploadPage?"pick active":"pick",onClick:function(){return!e.state.isLoading&&e.setState({isUploadPage:!0})}},"\u4e0a\u50b3\u4e00\u5f35\u7167\u7247")),i.a.createElement("div",{className:"slideshow-container"},i.a.createElement("div",{hidden:!this.state.isUploadPage},this.renderUploadImageSection()),i.a.createElement("div",{hidden:this.state.isUploadPage},this.renderPickImageSection())),i.a.createElement("div",{className:"greeting-message-block"},i.a.createElement("label",{className:"input"},i.a.createElement("h2",null,"@"),i.a.createElement("input",{type:"text",name:"name",placeholder:"\u59d3\u540d",onChange:this.onTextChangeHandler,required:!0,disabled:this.state.isLoading})),i.a.createElement("label",{className:"input"},i.a.createElement("textarea",{name:"greetings",placeholder:"\u795d\u8cc0\u8a5e",onChange:this.onTextChangeHandler,required:!0,disabled:this.state.isLoading}))),i.a.createElement("button",{className:"btn",type:"submit",disabled:this.state.isLoading},this.state.isLoading&&i.a.createElement("img",{className:"loading-img",src:F.a,alt:""}),"\u7559\u8a00"),i.a.createElement("a",{className:"link orange-font",href:this.getUpperUrl()},"\u53bb\u7167\u7247\u7246\u77a7\u77a7"))}},{key:"render",value:function(){return i.a.createElement("div",{className:"greeting"},i.a.createElement("header",{className:"greeting-header"},i.a.createElement("h1",{className:"greeting-title orange-font"},"\u795d\u798f\u7559\u8a00\u7248")),!this.state.modalDisplay&&this.renderGreetingForm(),i.a.createElement(R,{user:this.getFormData(),show:this.state.modalDisplay}))}}]),t}(n.Component),K=a(48),X=a.n(K),Z=function(){function e(){Object(g.a)(this,e),this.q=[]}return Object(p.a)(e,[{key:"push",value:function(e){this.q.push(e)}},{key:"pop",value:function(){return this.q.splice(0,1)[0]}},{key:"isEmpty",value:function(){return 0===this.q.length}}]),e}(),M=function(e){function t(){var e,a;Object(g.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(h.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(i)))).allImgUrls=w()(P.img.totalImgs).map((function(e){return C(e)})),a.bgImgUrls=x(a.allImgUrls,P.img.bgImgsShouldBePicked),a.intervals=[],a.state={isLoading:!0,modalDisplay:!1,user:{},permutation:L(w()(a.bgImgUrls.length)),isBgSwitching:!1},a.showDialog=function(e){a.setState({user:Object.assign({},e)});B(e.imgUrl,(function(){a.setState((function(){return{modalDisplay:!0}})),setTimeout((function(){a.setState((function(){return{modalDisplay:!1}}))}),5e3)}))},a.pickUpFeed=function(e,t){var n=e.isEmpty()?t.pop():e.pop();a.showDialog(n),t.push(n)},a}return Object(v.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e,t=this,a=new Z,n=new Z;e=function(e){return a.push(e)},A.database.ref("posts").on("child_added",(function(t){e(t.val())})),window.onload=function(){t.setState((function(e){return{isLoading:!e.isLoading}})),t.intervals.push(setInterval((function(){t.pickUpFeed(a,n)}),8e3))},this.intervals.push(setInterval((function(){t.setState({isBgSwitching:!0}),setTimeout((function(){t.setState({permutation:L(w()(t.bgImgUrls.length))}),setTimeout((function(){t.setState({isBgSwitching:!1})}),1e3)}),1e3)}),3e5))}},{key:"componentWillUnmount",value:function(){this.intervals.forEach(clearInterval)}},{key:"render",value:function(){var e=this;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"container"},this.state.isLoading&&i.a.createElement("div",{className:"loading"},i.a.createElement("img",{src:X.a,alt:""}),i.a.createElement("span",null,"Loading...")),this.bgImgUrls.map((function(t,a){return i.a.createElement("img",{key:t,className:e.state.isLoading||e.state.isBgSwitching?"hidden":"visible",style:{order:e.state.permutation[a]},src:t,alt:""})}))),i.a.createElement(R,{user:this.state.user,show:this.state.modalDisplay}),i.a.createElement("a",{className:"message-link",href:"".concat(this.props.match.url,"/greetings")},"<< \u7559\u4e0b\u4f60\u7684\u795d\u798f"))}}]),t}(n.Component),Y=function(e){var t,a=e.match;P.init(a.params.gnbId),J.init(P),t=P.doc.title,document.title=t;var n=a.url;return i.a.createElement(c.c,null,i.a.createElement(c.a,{path:"".concat(n,"/greetings"),component:G}),i.a.createElement(c.a,{path:n,component:M}))},Q=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function $(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var ee=function(){return i.a.createElement("div",null,"Weddi App")};o.a.render(i.a.createElement((function(){return i.a.createElement(s.a,{basename:"",forceRefresh:!0},i.a.createElement(c.c,null,i.a.createElement(c.a,{path:"/:gnbId/",component:Y}),i.a.createElement(c.a,{path:"/",component:ee})))}),null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("","/service-worker.js");Q?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):$(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):$(e)}))}}()}},[[51,1,2]]]);
//# sourceMappingURL=main.9c28e067.chunk.js.map