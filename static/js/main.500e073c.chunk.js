(this["webpackJsonpweddi-app"]=this["webpackJsonpweddi-app"]||[]).push([[0],{21:function(e,t,a){},28:function(e,t,a){},40:function(e,t,a){e.exports=a.p+"static/media/uploadLoading.a33612b2.svg"},42:function(e,t,a){e.exports=a.p+"static/media/loading.822699a4.gif"},45:function(e,t,a){e.exports=a(65)},50:function(e,t,a){},65:function(e,t,a){"use strict";a.r(t);var n,i=a(0),c=a.n(i),r=a(37),o=a.n(r),s=a(22),l=a(8),u=(a(50),a(1)),m=(a(28),a(23)),d=a.n(m),f=a(38),p=a(15),g=a(16),h=a(39),b=a.n(h),v=a(17),E=a(18),w={doc:{title:"<3 YaYun & ChinHui <3"},firebase:{apiKey:"AIzaSyD_1irJWOgT9x5fvmbXJm0fRRRZ8DNUfpU",authDomain:"weddi-app.firebaseapp.com",databaseURL:"https://weddi-app.firebaseio.com/",projectId:"weddi-app",storageBucket:"image.weddi.app",messagingSenderId:"324415165027",appId:"1:324415165027:web:76b8291835ef32c5c75e56"},post:{namespace:"chyy"},img:{namespace:"chyy",endpoint:"https://storage.googleapis.com/image.weddi.app/",bgImgsShouldBePicked:40,fmImgsShouldBePicked:5}},O={doc:{title:"<3 Tony & Claire <3"},firebase:{apiKey:"AIzaSyD_1irJWOgT9x5fvmbXJm0fRRRZ8DNUfpU",authDomain:"weddi-app.firebaseapp.com",databaseURL:"https://weddi-app.firebaseio.com/",projectId:"weddi-app",storageBucket:"image.weddi.app",messagingSenderId:"324415165027",appId:"1:324415165027:web:76b8291835ef32c5c75e56"},post:{namespace:"tlty"},img:{namespace:"tlty",endpoint:"https://storage.googleapis.com/image.weddi.app/",bgImgsShouldBePicked:30,fmImgsShouldBePicked:5}},j={doc:{title:"<3 \u5471\u5471 & \u4ee5\u7df4 <3"},firebase:{apiKey:"AIzaSyD_1irJWOgT9x5fvmbXJm0fRRRZ8DNUfpU",authDomain:"weddi-app.firebaseapp.com",databaseURL:"https://weddi-app.firebaseio.com/",projectId:"weddi-app",storageBucket:"image.weddi.app",messagingSenderId:"324415165027",appId:"1:324415165027:web:76b8291835ef32c5c75e56"},post:{namespace:"ykyl"},img:{namespace:"ykyl",endpoint:"https://storage.googleapis.com/image.weddi.app/",bgImgsShouldBePicked:28,fmImgsShouldBePicked:5}},y={doc:{title:"<3 Groom & Bride <3"},firebase:{apiKey:"AIzaSyD_1irJWOgT9x5fvmbXJm0fRRRZ8DNUfpU",authDomain:"weddi-app.firebaseapp.com",databaseURL:"https://weddi-app-test.firebaseio.com/",projectId:"weddi-app",storageBucket:"image.weddi.app",messagingSenderId:"324415165027",appId:"1:324415165027:web:76b8291835ef32c5c75e56"},post:{namespace:"test"},img:{namespace:"chyy",endpoint:"https://storage.googleapis.com/image.weddi.app/",bgImgsShouldBePicked:40,fmImgsShouldBePicked:5}},I=new(function(){function e(){Object(v.a)(this,e),this._config=null}return Object(E.a)(e,[{key:"init",value:function(e){null===this._config&&(this._config=function(e){switch(e){case"chyy":return w;case"tlty":return O;case"ykyl":return j;default:return y}}(e))}},{key:"config",get:function(){if(null===this._config)throw Error("config is not set yet");return this._config}}]),e}()),k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=Math.ceil(Math.min(e,t)),n=Math.floor(Math.max(e,t));return Math.floor(a+Math.random()*(n-a+1))},N=function(e,t){for(var a=[],n=e.length-t;n<e.length;n++){var i=k(n);a.includes(e[i])?a.push(e[n]):a.push(e[i])}return a},S=function(e){for(var t=0;t<=e.length-2;t++){var a=k(t,e.length-1),n=[e[a],e[t]];e[t]=n[0],e[a]=n[1]}return e},B=a(40),_=a.n(B),D=function(e){return function(t){var a=e.ref("".concat(I.config.post.namespace,"/posts")).push().key;if(!a)throw new Error("post id is empty");var n=Object(g.a)({},t,{modifiedTime:(new Date).toISOString(),userAgent:navigator.userAgent,id:a});return e.ref("".concat(I.config.post.namespace,"/posts")).child(a).set(n)}},U=function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"small";return e.ref(I.config.img.namespace).child(t).listAll().then((function(e){return Promise.all(e.items.map((function(e){return e.getDownloadURL()})))}))}},x=function(e){return function(t,a){return e.ref(I.config.img.namespace).child("public_upload").child(t).put(a)}},R=Object(i.createContext)({}),G=a(26),A=a(10),C=a.n(A),T=(a(66),a(54),function(e){var t=e.firebaseConfig,a=e.appName,n=Object(i.useMemo)((function(){if(!t)throw new Error("No config provided");var e,n,i=C.a.apps.find((function(e){return e.name===(a||"[DEFAULT]")}));return i&&((e=i.options)===(n=t)||[].concat(Object(G.a)(Object.keys(e)),Object(G.a)(Object.keys(n))).every((function(t){return e[t]===n[t]})))?{app:i,storage:C.a.storage(i),database:C.a.database(i)}:{app:C.a.initializeApp(t,a),storage:C.a.storage(),database:C.a.database()}}),[t,a]);return c.a.createElement(R.Provider,Object.assign({value:n},e))}),L=function(){return Object(i.useContext)(R).database},F=function(){return Object(i.useContext)(R).storage},P=function(e){var t=e.imgUrls,a=e.onChange,n=e.disabled,r=t.length,o=Object(i.useState)(0),s=Object(u.a)(o,2),l=s[0],m=s[1],d=function(e){var n=(l+e+r)%r;m(n),a&&a(t[n])};return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"img-window"},c.a.createElement("div",{className:"numbertext"},l+1," / ",r),t.map((function(e,t){var a=l===t;return c.a.createElement(c.a.Fragment,{key:e},c.a.createElement("input",{hidden:!0,type:"radio",name:"imgUrl",value:e,checked:a,readOnly:!0}),c.a.createElement("div",{className:"layer ".concat(a?"":" hidden"),style:{backgroundImage:"url(".concat(e,")")}}),c.a.createElement("img",{className:"fade ".concat(a?"":" hidden"),src:e,alt:e}))}))),c.a.createElement("span",{className:"prev",onClick:function(){return!n&&d(-1)}},"\u276e"),c.a.createElement("span",{className:"next",onClick:function(){return!n&&d(1)}},"\u276f"))},W=a(41),J=a.n(W),H=function(e){var t=e.disabled,a=e.onChange,n=Object(i.useState)(null),r=Object(u.a)(n,2),o=r[0],s=r[1];return c.a.createElement("label",{className:"img-window upload"},c.a.createElement("input",{hidden:!0,type:"file",name:"upload",placeholder:"\u4e0a\u50b3\u7167\u7247",accept:"image/*",onChange:function(e){var t=e.target,n=e.target.name,i=t.files&&t.files[0];n&&i&&i.type.startsWith("image/")&&J()(i,(function(e){return e.toBlob((function(e){s(e),a&&a(e)}),"image/jpeg",.75)}),{maxWidth:2048,maxHeight:2048,orientation:!0,canvas:!0,noRevoke:!0})},disabled:t}),o&&c.a.createElement("img",{src:URL.createObjectURL(o),alt:"upload preview"}),!o&&c.a.createElement("span",{className:"upload-field"},"\u8acb\u4e0a\u50b3\u5716\u7247"))},q=function(e){var t=e.onSubmit,a=Object(i.useState)(!1),n=Object(u.a)(a,2),r=n[0],o=n[1],s=Object(i.useState)({name:"",greetings:""}),l=Object(u.a)(s,2),m=l[0],h=l[1],v=Object(i.useState)(!1),E=Object(u.a)(v,2),w=E[0],O=E[1],j=Object(i.useState)([]),y=Object(u.a)(j,2),k=y[0],S=y[1],B=Object(i.useState)(""),R=Object(u.a)(B,2),G=R[0],A=R[1],C=Object(i.useState)(null),T=Object(u.a)(C,2),W=T[0],J=T[1],q=L(),M=F();Object(i.useEffect)((function(){U(M)().then((function(e){var t=N(e,I.config.img.fmImgsShouldBePicked);S(t),A(t[0])}))}),[M]);var z=function(e){var t=e.target.name,a=e.target.value.trim();h((function(e){return Object(g.a)({},e,Object(p.a)({},t,a))}))};return c.a.createElement("form",{className:"greeting-form",onSubmit:function(e){e.preventDefault();if(function(){var e=m.name,t=m.greetings;return""!==e.trim()&&""!==t.trim()&&(G||W)}())return function(){var e=Object(f.a)(d.a.mark((function e(){var a,n,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o(!0),a=G,!w||!W){e.next=10;break}return n=b.a.v4(),e.next=6,x(M)(n,W);case 6:return i=e.sent,e.next=9,i.ref.getDownloadURL();case 9:a=e.sent;case 10:return e.next=12,D(q)({name:m.name,greetings:m.greetings,imgUrl:a});case 12:A(a),o(!1),t&&t({name:m.name,greetings:m.greetings,imgUrl:a});case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}},c.a.createElement("ul",{className:"tabs-view"},c.a.createElement("li",{className:"pick ".concat(w?"":"active"),onClick:function(){r||O(!1)}},"\u6311\u4e00\u5f35\u7167\u7247"),c.a.createElement("li",{className:"pick ".concat(w?"active":""),onClick:function(){r||O(!0)}},"\u4e0a\u50b3\u4e00\u5f35\u7167\u7247")),c.a.createElement("div",{className:"slideshow-container"},c.a.createElement("div",{hidden:!w},c.a.createElement(H,{disabled:r,onChange:function(e){J(e)}})),c.a.createElement("div",{hidden:w},c.a.createElement(P,{disabled:r,imgUrls:k,onChange:function(e){A(e)}}))),c.a.createElement("div",{className:"greeting-message-block"},c.a.createElement("label",{className:"input"},c.a.createElement("h2",null,"@"),c.a.createElement("input",{type:"text",name:"name",placeholder:"\u59d3\u540d",onChange:z,required:!0,disabled:r})),c.a.createElement("label",{className:"input"},c.a.createElement("textarea",{name:"greetings",placeholder:"\u795d\u8cc0\u8a5e",onChange:z,required:!0,disabled:r}))),c.a.createElement("button",{className:"btn",type:"submit",disabled:r},r&&c.a.createElement("img",{className:"loading-img",src:_.a,alt:""}),"\u7559\u8a00"))},M=(a(21),function(e){var t=e.user,a=e.show,n=Object(i.useState)(!1),r=Object(u.a)(n,2),o=r[0],s=r[1],l=Object(i.useRef)();Object(i.useEffect)((function(){t.imgUrl&&s(!0)}),[t.imgUrl]);var m=window.innerWidth<1e3,d=!o&&l.current&&l.current.clientWidth<l.current.clientHeight,f=!o&&m&&d?{margin:"10% 20% 50px"}:{};return c.a.createElement("div",{className:"dialog ".concat(a&&!o?"show-dialog":"")},c.a.createElement("div",{className:"modal-sm",style:f},c.a.createElement("div",{className:"image-container"},c.a.createElement("img",{ref:l,className:"user-image",src:t.imgUrl,alt:"images",onLoad:function(){s(!1)}})),c.a.createElement("div",{className:"message"},c.a.createElement("h2",null,"@ ",t.name),c.a.createElement("p",null,t.greetings))))}),z=function(e){var t=Object(i.useState)(!1),a=Object(u.a)(t,2),n=a[0],r=a[1],o=function(){var t=e.match.url.split("/");return t.pop(),t.join("/")},s=Object(i.useState)({name:"",greetings:"",imgUrl:""}),l=Object(u.a)(s,2),m=l[0],d=l[1];return c.a.createElement("div",{className:"greeting"},c.a.createElement("header",{className:"greeting-header"},c.a.createElement("h1",{className:"greeting-title orange-font"},"\u795d\u798f\u7559\u8a00\u7248")),!n&&c.a.createElement(q,{onSubmit:function(t){d(t),r(!0),setTimeout((function(){e.history.push(o())}),5e3)}}),!n&&c.a.createElement("a",{className:"link orange-font",href:o()},"\u53bb\u7167\u7247\u7246\u77a7\u77a7"),c.a.createElement(M,{user:m,show:n}))},V=function(e){return new Promise((function(t){!function(e,t){var a=new Image;a.src=e,a.onload=function(){return t(a)}}(e,t)}))},K=a(42),X=a.n(K);!function(e){e.BG_FADE_IN="BG_FADE_IN",e.BG_FADE_OUT="BG_FADE_OUT",e.BG_HIDDEN="BG_HIDDEN",e.BG_VISIBLE="BG_VISIBLE"}(n||(n={}));var Z=function(){var e=F(),t=Object(i.useState)(!0),a=Object(u.a)(t,2),r=a[0],o=a[1],s=Object(i.useState)(n.BG_HIDDEN),l=Object(u.a)(s,2),m=l[0],d=l[1],f=Object(i.useState)([]),p=Object(u.a)(f,2),g=p[0],h=p[1];return Object(i.useEffect)((function(){r&&U(e)().then((function(e){Promise.all(e.map(V)).then((function(){return o(!1)})),h(S(N(e,I.config.img.bgImgsShouldBePicked)))}))}),[e,r]),Object(i.useEffect)((function(){switch(m){case n.BG_FADE_OUT:setTimeout((function(){d(n.BG_HIDDEN),h((function(e){return S(e)}))}),1e3);break;case n.BG_HIDDEN:setTimeout((function(){d(n.BG_FADE_IN)}),1500);break;case n.BG_FADE_IN:setTimeout((function(){d(n.BG_VISIBLE)}),1e3);break;case n.BG_VISIBLE:setTimeout((function(){d(n.BG_FADE_OUT)}),18e5)}}),[m]),c.a.createElement("div",{className:"container"},r&&c.a.createElement("div",{className:"loading"},c.a.createElement("img",{src:X.a,alt:""}),c.a.createElement("span",null,"Loading...")),g.map((function(e){return c.a.createElement("img",{key:e,className:r||m===n.BG_HIDDEN?"hidden":m===n.BG_VISIBLE?"visible":m===n.BG_FADE_IN?"fade-in":m===n.BG_FADE_OUT?"fade-out":"",src:e,alt:""})})))},Y=function(){function e(){Object(v.a)(this,e),this.q=void 0,this.q=[]}return Object(E.a)(e,[{key:"push",value:function(e){this.q.push(e)}},{key:"pop",value:function(){return this.q.splice(0,1)[0]}},{key:"isEmpty",value:function(){return 0===this.q.length}}]),e}(),Q=function(e){return function(t){var a=new Y,n=new Y;!function(e){return function(t){e.ref("".concat(I.config.post.namespace,"/posts")).on("child_added",(function(e){t(e.val())}))}}(e)((function(e){return a.push(e)}));var i=setInterval((function(){var e=a.isEmpty()?n.pop():a.pop();e&&n.push(e),t(e)}),8e3);return function(){clearInterval(i)}}},$=function(e){var t=Object(i.useState)(!1),a=Object(u.a)(t,2),n=a[0],r=a[1],o=Object(i.useState)({}),s=Object(u.a)(o,2),l=s[0],m=s[1],d=L();return Object(i.useEffect)((function(){var e=Q(d)((function(e){if(e){m(e);r(!0),setTimeout((function(){r(!1)}),5e3)}}));return function(){e()}}),[d]),c.a.createElement(c.a.Fragment,null,c.a.createElement(Z,null),c.a.createElement(M,{user:l,show:n}),c.a.createElement("a",{className:"message-link",href:"".concat(e.match.url,"/greetings")},"<< \u7559\u4e0b\u4f60\u7684\u795d\u798f"))},ee=function(e){var t,a=e.match;I.init(a.params.gnbId),t=I.config.doc.title,document.title=t;var n=a.url;return c.a.createElement(T,{firebaseConfig:I.config.firebase},c.a.createElement(l.c,null,c.a.createElement(l.a,{path:"".concat(n,"/greetings"),component:z}),c.a.createElement(l.a,{path:n,component:$})))},te=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ae(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var ne=function(){return c.a.createElement("div",null,"Weddi App")};o.a.render(c.a.createElement((function(){return c.a.createElement(s.a,{basename:"",forceRefresh:!0},c.a.createElement(l.c,null,c.a.createElement(l.a,{path:"/:gnbId/",component:ee}),c.a.createElement(l.a,{path:"/",component:ne})))}),null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("","/service-worker.js");te?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):ae(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):ae(e)}))}}()}},[[45,1,2]]]);
//# sourceMappingURL=main.500e073c.chunk.js.map