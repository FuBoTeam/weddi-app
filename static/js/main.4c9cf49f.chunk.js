(this["webpackJsonpweddi-app"]=this["webpackJsonpweddi-app"]||[]).push([[0],{34:function(e,t,a){},39:function(e,t,a){},50:function(e,t,a){e.exports=a.p+"static/media/uploadLoading.a33612b2.svg"},52:function(e,t,a){e.exports=a.p+"static/media/loading.822699a4.gif"},56:function(e,t,a){e.exports=a(75)},61:function(e,t,a){},70:function(e,t,a){},75:function(e,t,a){"use strict";a.r(t);var n,c=a(1),r=a.n(c),i=a(48),o=a.n(i),s=a(35),l=a(9),u=(a(61),a(5)),m=(a(39),a(10)),f=a.n(m),d=a(15),p=a(4),g=a(22),b=a(49),h=a.n(b),v=a(2),E=a(3),j={doc:{title:"<3 YaYun & ChinHui <3"},firebase:{apiKey:"AIzaSyD_1irJWOgT9x5fvmbXJm0fRRRZ8DNUfpU",authDomain:"weddi-app.firebaseapp.com",databaseURL:"https://weddi-app.firebaseio.com/",projectId:"weddi-app",storageBucket:"image.weddi.app",messagingSenderId:"324415165027",appId:"1:324415165027:web:76b8291835ef32c5c75e56"},post:{namespace:"chyy"},img:{namespace:"chyy",bgImgsShouldBePicked:40,fmImgsShouldBePicked:5}},O={doc:{title:"<3 Tony & Claire <3"},firebase:{apiKey:"AIzaSyD_1irJWOgT9x5fvmbXJm0fRRRZ8DNUfpU",authDomain:"weddi-app.firebaseapp.com",databaseURL:"https://weddi-app.firebaseio.com/",projectId:"weddi-app",storageBucket:"image.weddi.app",messagingSenderId:"324415165027",appId:"1:324415165027:web:76b8291835ef32c5c75e56"},post:{namespace:"tlty"},img:{namespace:"tlty",bgImgsShouldBePicked:30,fmImgsShouldBePicked:5}},k={doc:{title:"<3 \u5471\u5471 & \u4ee5\u7df4 <3"},firebase:{apiKey:"AIzaSyD_1irJWOgT9x5fvmbXJm0fRRRZ8DNUfpU",authDomain:"weddi-app.firebaseapp.com",databaseURL:"https://weddi-app.firebaseio.com/",projectId:"weddi-app",storageBucket:"image.weddi.app",messagingSenderId:"324415165027",appId:"1:324415165027:web:76b8291835ef32c5c75e56"},post:{namespace:"ykyl"},img:{namespace:"ykyl",bgImgsShouldBePicked:28,fmImgsShouldBePicked:5}},w={doc:{title:"<3 Groom & Bride <3"},firebase:{apiKey:"AIzaSyD_1irJWOgT9x5fvmbXJm0fRRRZ8DNUfpU",authDomain:"weddi-app.firebaseapp.com",databaseURL:"https://weddi-app.firebaseio.com/",projectId:"weddi-app",storageBucket:"image.weddi.app",messagingSenderId:"324415165027",appId:"1:324415165027:web:76b8291835ef32c5c75e56"},post:{namespace:"test"},img:{namespace:"chyy",bgImgsShouldBePicked:40,fmImgsShouldBePicked:5}},y=new(function(){function e(){Object(v.a)(this,e),this._config=null}return Object(E.a)(e,[{key:"init",value:function(e){null===this._config&&(this._config=function(e){switch(e){case"chyy":return j;case"tlty":return O;case"ykyl":return k;default:return w}}(e))}},{key:"config",get:function(){if(null===this._config)throw Error("config is not set yet");return this._config}}]),e}()),S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=Math.ceil(Math.min(e,t)),n=Math.floor(Math.max(e,t));return Math.floor(a+Math.random()*(n-a+1))},N=function(e,t){for(var a=[],n=e.length-t;n<e.length;n++){var c=S(n);a.includes(e[c])?a.push(e[n]):a.push(e[c])}return a},I=function(e){for(var t=0;t<=e.length-2;t++){var a=S(t,e.length-1),n=[e[a],e[t]];e[t]=n[0],e[a]=n[1]}return e},B=a(50),_=a.n(B),D=a(13),C=a(20),U=function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{joinedGame:!1},n=Object(D.h)(e,"".concat(y.config.post.namespace,"/posts")),c=null!==(t=a.joinedGame)&&void 0!==t&&t;return c&&(n=Object(D.g)(n,Object(D.e)("joinedGame"),Object(D.a)(!0))),new Promise((function(e){return Object(D.d)(n,(function(t){e(t.val())}),{onlyOnce:!0})}))},G=function(e,t){var a=Object(D.f)(Object(D.h)(e,"".concat(y.config.post.namespace,"/posts"))).key;if(!a)throw new Error("post id is empty");var n=Object(g.a)(Object(g.a)({},t),{},{modifiedTime:(new Date).toISOString(),userAgent:navigator.userAgent,id:a});return Object(D.i)(Object(D.h)(e,"".concat(y.config.post.namespace,"/posts/").concat(a,"}")),n)},R=function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{size:"small"},n=null!==(t=a.size)&&void 0!==t?t:"small";return Object(C.c)(Object(C.d)(e,"".concat(y.config.img.namespace,"/").concat(n))).then((function(e){return Promise.all(e.items.map(C.a))}))},x=function(e,t,a){return Object(C.e)(Object(C.d)(e,"".concat(y.config.img.namespace,"/public_upload/").concat(t)),a).then((function(e){return Object(C.a)(e.ref)}))},L=Object(c.createContext)({}),T=a(18),A=a(36),F=function(e){var t=e.firebaseConfig,a=e.appName,n=Object(c.useMemo)((function(){if(!t)throw new Error("No config provided");var e,n,c=Object(A.a)().find((function(e){return e.name===(a||"[DEFAULT]")}));if(c&&((e=c.options)===(n=t)||[].concat(Object(T.a)(Object.keys(e)),Object(T.a)(Object.keys(n))).every((function(t){return e[t]===n[t]}))))return{app:c,storage:Object(C.b)(c),database:Object(D.b)(c)};var r=Object(A.b)(t,a);return{app:r,storage:Object(C.b)(r),database:Object(D.b)(r)}}),[t,a]);return r.a.createElement(L.Provider,Object.assign({value:n},e))},P=function(){return Object(c.useContext)(L).database},W=function(){return Object(c.useContext)(L).storage},M=function(e){var t=e.imgUrls,a=e.onChange,n=e.disabled,i=t.length,o=Object(c.useState)(0),s=Object(u.a)(o,2),l=s[0],m=s[1],f=function(e){var n=(l+e+i)%i;m(n),a&&a(t[n])};return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"img-window"},r.a.createElement("div",{className:"numbertext"},l+1," / ",i),t.map((function(e,t){var a=l===t;return r.a.createElement(r.a.Fragment,{key:e},r.a.createElement("input",{hidden:!0,type:"radio",name:"imgUrl",value:e,checked:a,readOnly:!0}),r.a.createElement("div",{className:"layer ".concat(a?"":" hidden"),style:{backgroundImage:"url(".concat(e,")")}}),r.a.createElement("img",{className:"fade ".concat(a?"":" hidden"),src:e,alt:e}))}))),r.a.createElement("span",{className:"prev",onClick:function(){return!n&&f(-1)}},"\u276e"),r.a.createElement("span",{className:"next",onClick:function(){return!n&&f(1)}},"\u276f"))},J=a(51),H=a.n(J),z=function(e){var t=e.disabled,a=e.onChange,n=Object(c.useState)(null),i=Object(u.a)(n,2),o=i[0],s=i[1];return r.a.createElement("label",{className:"img-window upload"},r.a.createElement("input",{hidden:!0,type:"file",name:"upload",placeholder:"\u4e0a\u50b3\u7167\u7247",accept:"image/*",onChange:function(e){var t=e.target,n=e.target.name,c=t.files&&t.files[0];n&&c&&c.type.startsWith("image/")&&H()(c,(function(e){return e.toBlob((function(e){s(e),a&&a(e)}),"image/jpeg",.75)}),{maxWidth:2048,maxHeight:2048,orientation:!0,canvas:!0,noRevoke:!0})},disabled:t}),o&&r.a.createElement("img",{src:URL.createObjectURL(o),alt:"upload preview"}),!o&&r.a.createElement("span",{className:"upload-field"},"\u8acb\u4e0a\u50b3\u5716\u7247"))},V=function(e){var t=e.onSubmit,a=Object(c.useState)(!1),n=Object(u.a)(a,2),i=n[0],o=n[1],s=Object(c.useState)({name:"",greetings:""}),l=Object(u.a)(s,2),m=l[0],b=l[1],v=Object(c.useState)(!1),E=Object(u.a)(v,2),j=E[0],O=E[1],k=Object(c.useState)([]),w=Object(u.a)(k,2),S=w[0],I=w[1],B=Object(c.useState)(""),D=Object(u.a)(B,2),C=D[0],U=D[1],L=Object(c.useState)(null),T=Object(u.a)(L,2),A=T[0],F=T[1],J=P(),H=W();Object(c.useEffect)((function(){R(H).then((function(e){var t=N(e,y.config.img.fmImgsShouldBePicked);I(t),U(t[0])}))}),[H]);var V=function(e){var t=e.target.name,a=e.target.value.trim();b((function(e){return Object(g.a)(Object(g.a)({},e),{},Object(p.a)({},t,a))}))};return r.a.createElement("form",{className:"greeting-form",onSubmit:function(e){e.preventDefault();if(function(){var e=m.name,t=m.greetings;return""!==e.trim()&&""!==t.trim()&&(C||A)}())return function(){var e=Object(d.a)(f.a.mark((function e(){var a,n,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o(!0),a=C,!j||!A){e.next=7;break}return n=h.a.v4(),e.next=6,x(H,n,A);case 6:a=e.sent;case 7:return c={name:m.name,greetings:m.greetings,joinedGame:!0,imgUrl:a},e.next=10,G(J,c);case 10:U(a),o(!1),t&&t(c);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}},r.a.createElement("ul",{className:"tabs-view"},r.a.createElement("li",{className:"pick ".concat(j?"":"active"),onClick:function(){i||O(!1)}},"\u6311\u4e00\u5f35\u7167\u7247"),r.a.createElement("li",{className:"pick ".concat(j?"active":""),onClick:function(){i||O(!0)}},"\u4e0a\u50b3\u4e00\u5f35\u7167\u7247")),r.a.createElement("div",{className:"slideshow-container"},r.a.createElement("div",{hidden:!j},r.a.createElement(z,{disabled:i,onChange:function(e){F(e)}})),r.a.createElement("div",{hidden:j},r.a.createElement(M,{disabled:i,imgUrls:S,onChange:function(e){U(e)}}))),r.a.createElement("div",{className:"greeting-message-block"},r.a.createElement("label",{className:"input"},r.a.createElement("h2",null,"@"),r.a.createElement("input",{type:"text",name:"name",placeholder:"\u59d3\u540d",onChange:V,required:!0,disabled:i})),r.a.createElement("label",{className:"input"},r.a.createElement("textarea",{name:"greetings",placeholder:"\u795d\u8cc0\u8a5e",onChange:V,required:!0,disabled:i}))),r.a.createElement("button",{className:"btn",type:"submit",disabled:i},i&&r.a.createElement("img",{className:"loading-img",src:_.a,alt:""}),"\u7559\u8a00"))},K=(a(34),function(e){var t=e.user,a=e.show,n=Object(c.useState)(!1),i=Object(u.a)(n,2),o=i[0],s=i[1],l=Object(c.useRef)();Object(c.useEffect)((function(){t.imgUrl&&s(!0)}),[t.imgUrl]);var m=window.innerWidth<1e3,f=!o&&l.current&&l.current.clientWidth<l.current.clientHeight,d=!o&&m&&f?{margin:"10% 20% 50px"}:{};return r.a.createElement("div",{className:"dialog ".concat(a&&!o?"show-dialog":"")},r.a.createElement("div",{className:"modal-sm",style:d},r.a.createElement("div",{className:"image-container"},r.a.createElement("img",{ref:l,className:"user-image",src:t.imgUrl,alt:"images",onLoad:function(){s(!1)}})),r.a.createElement("div",{className:"message"},r.a.createElement("h2",null,"@ ",t.name),r.a.createElement("p",null,t.greetings))))}),X=function(e){var t=e.split("/");return t.pop(),t.join("/")},Z=function(e){var t=Object(c.useState)(!1),a=Object(u.a)(t,2),n=a[0],i=a[1],o=Object(c.useState)({name:"",greetings:"",imgUrl:""}),s=Object(u.a)(o,2),l=s[0],m=s[1],f=Object(c.useCallback)((function(t){m(t),i(!0),setTimeout((function(){e.history.push(X(e.match.url))}),5e3)}),[m,i,e.history,e.match.url]);return r.a.createElement("div",{className:"greeting"},r.a.createElement("header",{className:"greeting-header"},r.a.createElement("h1",{className:"greeting-title orange-font"},"\u795d\u798f\u7559\u8a00\u7248")),!n&&r.a.createElement(V,{onSubmit:f}),!n&&r.a.createElement("a",{className:"link orange-font",href:X(e.match.url)},"\u53bb\u7167\u7247\u7246\u77a7\u77a7"),r.a.createElement(K,{user:l,show:n}))},q=function(e){return new Promise((function(t){!function(e,t){var a=new Image;a.src=e,a.onload=function(){return t(a)}}(e,t)}))},Y=a(52),Q=a.n(Y);!function(e){e.BG_FADE_IN="BG_FADE_IN",e.BG_FADE_OUT="BG_FADE_OUT",e.BG_HIDDEN="BG_HIDDEN",e.BG_VISIBLE="BG_VISIBLE"}(n||(n={}));var $,ee=function(){var e=W(),t=Object(c.useState)(!0),a=Object(u.a)(t,2),i=a[0],o=a[1],s=Object(c.useState)(n.BG_HIDDEN),l=Object(u.a)(s,2),m=l[0],f=l[1],d=Object(c.useState)([]),p=Object(u.a)(d,2),g=p[0],b=p[1];return Object(c.useEffect)((function(){i&&R(e).then((function(e){Promise.all(e.map(q)).then((function(){return o(!1)})),b(I(N(e,y.config.img.bgImgsShouldBePicked)))}))}),[e,i]),Object(c.useEffect)((function(){switch(m){case n.BG_FADE_OUT:setTimeout((function(){f(n.BG_HIDDEN),b((function(e){return I(e)}))}),1e3);break;case n.BG_HIDDEN:setTimeout((function(){f(n.BG_FADE_IN)}),1500);break;case n.BG_FADE_IN:setTimeout((function(){f(n.BG_VISIBLE)}),1e3);break;case n.BG_VISIBLE:setTimeout((function(){f(n.BG_FADE_OUT)}),18e5)}}),[m]),r.a.createElement("div",{className:"container"},i&&r.a.createElement("div",{className:"loading"},r.a.createElement("img",{src:Q.a,alt:""}),r.a.createElement("span",null,"Loading...")),g.map((function(e){return r.a.createElement("img",{key:e,className:i||m===n.BG_HIDDEN?"hidden":m===n.BG_VISIBLE?"visible":m===n.BG_FADE_IN?"fade-in":m===n.BG_FADE_OUT?"fade-out":"",src:e,alt:""})})))},te=function(e,t){return{priority:e,timestampId:t}},ae=function(e){var t=function(e){return Math.floor(e/2)},a=function(t,a,n){return e(t[a],t[n])},n=function(e,t,a){var n=[e[a],e[t]];e[t]=n[0],e[a]=n[1]},c=function(e,c){for(var r,i=c;i<t(e.length);){var o=[2*(r=i)+1,2*r+2],s=Object(u.a)(o,2),l=s[0],m=s[1],f=l;if(m<e.length&&a(e,m,f)&&(f=m),a(e,i,f))break;n(e,i,f),i=f}};return{init:function(e){for(var a=t(e.length)-1;a>=0;a--)c(e,a)},push:function(e,t){e.push(t);for(var c,r=e.length-1;0!==r;){var i=(c=r,Math.floor((c-1)/2));if(a(e,i,r))break;n(e,i,r),r=i}},pop:function(e){if(0!==e.length){n(e,0,e.length-1);var t=e.pop();return c(e,0),t}}}}((function(e,t){return e.priority<t.priority||e.priority===t.priority&&e.timestampId<t.timestampId})),ne=function(e){return function(t){var a={},n=[];U(e).then((function(e){null!==e&&Object.keys(e).forEach((function(t){a[t]=e[t]}))})).then((function(){!function(e,t){var a=Object(D.h)(e,"".concat(y.config.post.namespace,"/posts"));Object(D.c)(a,(function(e){t(e.val())}))}(e,(function(e){a[e.id]||(a[e.id]=e,ae.push(n,te(0,e.id)))}))}));var c=setInterval((function(){0===n.length&&(n=Object.keys(a).map((function(e){return te(1,e)})),ae.init(n));var e=ae.pop(n);e&&t(a[e.timestampId])}),8e3);return function(){clearInterval(c)}}},ce=function(e){var t=Object(c.useState)(!1),a=Object(u.a)(t,2),n=a[0],i=a[1],o=Object(c.useState)({}),s=Object(u.a)(o,2),l=s[0],m=s[1],f=P();return Object(c.useEffect)((function(){var e=ne(f)((function(e){if(e){m(e);i(!0),setTimeout((function(){i(!1)}),5e3)}}));return function(){e()}}),[f]),r.a.createElement(r.a.Fragment,null,r.a.createElement(ee,null),r.a.createElement(K,{user:l,show:n}),r.a.createElement("a",{className:"message-link",href:"".concat(e.match.url,"/greetings")},"<< \u7559\u4e0b\u4f60\u7684\u795d\u798f"),r.a.createElement("a",{className:"game-link",href:"".concat(e.match.url,"/lottery")},"\u53bb\u904a\u6232\u9801"))};a(70);!function(e){e[e.Init=0]="Init",e[e.Loaded=1]="Loaded",e[e.Start=2]="Start",e[e.Flipped=3]="Flipped",e[e.Stacked=4]="Stacked",e[e.Shuffling=5]="Shuffling",e[e.Shuffled=6]="Shuffled",e[e.Ready=7]="Ready",e[e.Error=8]="Error"}($||($={}));var re=function(e){var t=P(),a=Object(c.useState)([]),n=Object(u.a)(a,2),i=n[0],o=n[1],s=Object(c.useState)($.Init),l=Object(u.a)(s,2),m=l[0],f=l[1];Object(c.useEffect)((function(){U(t,{joinedGame:!0}).then((function(e){if(null!==e){var t=Object.keys(e).map((function(t){return e[t]})),a=I(t);o(a),f($.Loaded)}else f($.Error)}))}),[t]);var d=Object(c.useState)(!0),b=Object(u.a)(d,2),h=b[0],v=b[1],E=Object(c.useState)(!1),j=Object(u.a)(E,2),O=j[0],k=j[1],w=Object(c.useState)({"*":!0}),y=Object(u.a)(w,2),S=y[0],N=y[1],B=Object(c.useCallback)((function(){N((function(e){return e["*"]?{"*":!1}:{"*":!0}}))}),[]),_=Object(c.useCallback)((function(e){N((function(t){return Object(g.a)(Object(g.a)({},t),{},Object(p.a)({},e,!0))}))}),[]),D=Object(c.useCallback)((function(){v((function(e){return!e}))}),[]),C=Object(c.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;k(!0);var t=setTimeout((function(){o((function(e){return I(e)})),k(!1),clearTimeout(t),e&&e()}),3600)}),[]);Object(c.useEffect)((function(){switch(m){case $.Start:return B(),void f($.Flipped);case $.Flipped:return D(),void f($.Stacked);case $.Stacked:return C((function(){return f($.Shuffled)})),void f($.Shuffling);case $.Shuffled:return D(),void f($.Ready)}}),[m,B,D,C]);for(var G=Object(c.useCallback)((function(){m===$.Loaded&&f($.Start)}),[m]),R=Object(c.useCallback)((function(){v(!0),k(!1),N({"*":!0}),f($.Loaded)}),[v,k,N,f]),x=i.map((function(e,t){return r.a.createElement("li",{key:e.id,className:"card",onClick:function(){return _(t)}},r.a.createElement("div",{className:"inner ".concat(S["*"]||S[t]?"":"flip-transition")},r.a.createElement("div",{className:"front"},e.name),r.a.createElement("div",{className:"back"},h?t+1:"")))})),L=Math.min(10,Math.floor(Math.sqrt(x.length))),T=[];x.length>0;){var A=x.splice(0,L);T.push(r.a.createElement("li",{key:"stack-".concat(T.length),className:"stack"},r.a.createElement("ul",{className:"cards-down"},A)))}return r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"system-message"},m===$.Init?"Loading...":"",m===$.Error?"\u73fe\u5728\u9084\u6c92\u6709\u73a9\u5bb6\u5594\uff01":""),r.a.createElement("div",{className:"lottery-btns"},r.a.createElement("button",{className:m===$.Loaded?"show":"hide",onClick:G},"\u6d17\u724c"),r.a.createElement("button",{className:m===$.Ready?"show":"hide",onClick:R},"\u91cd\u7f6e")),r.a.createElement("ul",{className:"card-stacks ".concat(h?"expand-transition":""," ").concat(O?"shuffle-transition":"")},T),r.a.createElement("a",{className:"home-link",href:X(e.match.url)},"\u56de\u9996\u9801"))},ie=function(e){var t,a=e.match;y.init(a.params.gnbId),t=y.config.doc.title,document.title=t;var n=a.url;return r.a.createElement(F,{firebaseConfig:y.config.firebase},r.a.createElement(l.c,null,r.a.createElement(l.a,{path:"".concat(n,"/lottery"),component:re}),r.a.createElement(l.a,{path:"".concat(n,"/greetings"),component:Z}),r.a.createElement(l.a,{path:n,component:ce})))},oe=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function se(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var le=function(){return r.a.createElement("div",null,"Weddi App")},ue=function(){return r.a.createElement(s.a,{basename:"",forceRefresh:!0},r.a.createElement(l.c,null,r.a.createElement(l.a,{path:"/:gnbId/",component:ie}),r.a.createElement(l.a,{path:"/",component:le})))};o.a.render(r.a.createElement(ue,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("","/service-worker.js");oe?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):se(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):se(e)}))}}()}},[[56,1,2]]]);
//# sourceMappingURL=main.4c9cf49f.chunk.js.map